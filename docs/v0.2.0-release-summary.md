# Release v0.2.0-alpha - Cross-Cluster gRPC Communication

## Overview
This release implements end-to-end gRPC communication between Glooscap (ocp-ai-sno-2) and Nanabush (ocp-sno-1050ti) via HAProxy with MetalLB L2 load balancing.

## Major Features

### 1. gRPC Server Implementation (Nanabush)
- **Complete gRPC server** (`server/`) with Protocol Buffers service definition
- **TranslationService** with methods:
  - `RegisterClient` - Client registration with unique client IDs
  - `Heartbeat` - Keepalive and re-authentication
  - `CheckTitle` - Pre-flight title validation
  - `Translate` - Full document translation (placeholder)
  - `TranslateStream` - Streaming translation (placeholder)
- **Client tracking** - Registration, heartbeat monitoring, and cleanup
- **Health checks** - gRPC health service for Kubernetes probes
- **Metrics logging** - Client metrics, heartbeat stats, connection tracking

### 2. gRPC Client Implementation (Glooscap)
- **Auto-registration** - Automatically registers on connection
- **Heartbeat system** - Periodic heartbeats with configurable interval
- **Reconnection logic** - Automatic reconnection with exponential backoff
- **Connection management** - Graceful shutdown and connection state tracking

### 3. Cross-Cluster Networking
- **MetalLB L2 mode** - LoadBalancer service on ocp-sno-1050ti (IP: 10.20.2.0/24)
- **HAProxy configuration** - TCP/HTTP/2 forwarding from ocp-ai-sno-2
  - Rate limiting (50 conn/10s, 100 concurrent per IP)
  - TCP logging and connection tracking
  - Health checks and timeout configuration
- **Service exposure** - External endpoint: `209.15.95.244:50051`

### 4. Kubernetes Deployment
- **Nanabush deployment** (ocp-sno-1050ti):
  - Deployment with resource optimization
  - LoadBalancer service with MetalLB
  - NetworkPolicy for ingress control
  - SecurityContextConstraints (SCC) configuration
- **Glooscap configuration** (ocp-ai-sno-2):
  - Environment variables for nanabush connection
  - Auto-registration on startup

## Technical Details

### Protocol Buffers
- **Service definition**: `proto/translation.proto`
- **Server stubs**: `server/pkg/proto/v1/` (generated)
- **Client stubs**: `operator/pkg/nanabush/proto/v1/` (generated)
- **Separation**: Separate proto files for client/server to avoid import conflicts

### Infrastructure
- **MetalLB**: IP pool 10.20.2.0/24, L2 advertisement
- **HAProxy**: Frontend on port 50051, backend to 10.20.2.0:50051
- **Connection path**: Glooscap → HAProxy → MetalLB → Nanabush

### Configuration
- **Nanabush**: Port 50051, insecure mode (TLS future work)
- **Glooscap**: Endpoint `209.15.95.244:50051`, auto-registration enabled
- **Heartbeat**: 60 second interval (configurable)

## Files Added/Modified

### Nanabush
- `server/` - Complete gRPC server implementation
- `proto/translation.proto` - Service definition (with RegisterClient/Heartbeat)
- `proto/translation-server.proto` - Server-specific proto generation
- `kustomize/base/grpc-server-*.yaml` - Kubernetes manifests
- `kustomize/base/metallb-*.yaml` - MetalLB configuration
- `docs/haproxy-*.md` - HAProxy configuration documentation
- `docs/grpc-*.md` - gRPC implementation documentation
- `scripts/build-grpc-server.sh` - Build script
- `Makefile` - Proto generation targets

### Glooscap
- `operator/pkg/nanabush/client.go` - gRPC client implementation
- `operator/pkg/nanabush/proto/v1/` - Generated proto stubs
- `operator/cmd/main.go` - Client initialization and registration
- `operator/config/manager/manager.yaml` - Environment configuration

## Testing
- ✅ Direct MetalLB connection (10.20.2.0:50051)
- ✅ HAProxy endpoint (209.15.95.244:50051)
- ✅ RegisterClient RPC
- ✅ Heartbeat RPC
- ✅ Client auto-registration
- ✅ End-to-end connection from Glooscap to Nanabush

## Known Limitations
- TLS/mTLS not yet implemented (running in insecure mode)
- vLLM backend integration placeholder (returns mock responses)
- Rate limiting configured but may need tuning
- HAProxy uses external IP directly (internal DNS resolution issue)

## Next Steps (v0.3.0-alpha)
1. Implement TLS/mTLS for secure communication
2. Integrate vLLM backend (RHOAI/KServe)
3. Add Prometheus metrics
4. Integrate OTEL tracing
5. Implement per-client rate limiting
6. Add comprehensive error handling and retries

## Breaking Changes
None - this is the first gRPC implementation.

## Migration Notes
N/A - initial implementation.

## Git Tags
- **Nanabush**: `v0.2.0-alpha` (commit: f1f8210)
- **Glooscap**: `v0.2.0-alpha` (commit: 0301c6c)

## Deployment Status
- ✅ Nanabush gRPC server: Running on ocp-sno-1050ti
- ✅ MetalLB: Configured with IP 10.20.2.0:50051
- ✅ HAProxy: Configured and forwarding from ocp-ai-sno-2
- ✅ Glooscap operator: Connected and registered with Nanabush
- ✅ Heartbeat system: Active and working

## Connection Flow
```
Glooscap (ocp-ai-sno-2)
  ↓
HAProxy (209.15.95.244:50051)
  ↓ (L2 TCP forwarding)
MetalLB (10.20.2.0:50051)
  ↓
Nanabush gRPC Server (ocp-sno-1050ti)
```

All systems operational and tested. ✅
